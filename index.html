<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pollen | Share files naturally</title>
    <link rel="stylesheet" href="style.css">

    <!-- External Libraries -->
    <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
</head>

<body>
    <div id="app">
        <header class="app-header">
            <div class="logo">Pollen</div>
            <div class="theme-toggle" id="theme-toggle">
                <!-- Icon will be inserted by JS -->
            </div>
        </header>

        <main class="main-container">
            <!-- Sidebar / Configuration Panel -->
            <section id="connection-panel" class="panel sidebar-panel">
                <div class="my-identity">
                    <span class="label">Your Identity</span>
                    <h2 id="my-peer-id" class="nature-id">Loading...</h2>
                    <div id="qrcode-container"></div>
                    <button id="copy-id-btn" class="btn icon-btn" title="Copy ID">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                    </button>
                    <!-- Trigger for scanner -->
                    <button id="scan-qr-btn" class="btn icon-btn" title="Scan QR">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M3 7V5a2 2 0 0 1 2-2h2" />
                            <path d="M17 3h2a2 2 0 0 1 2 2v2" />
                            <path d="M21 17v2a2 2 0 0 1-2 2h-2" />
                            <path d="M7 21H5a2 2 0 0 1-2-2v-2" />
                        </svg>
                    </button>
                </div>

                <div class="connect-action">
                    <input type="text" id="remote-peer-id-input" placeholder="Enter peer ID">
                    <button id="connect-btn" class="btn primary-btn">Connect</button>
                </div>

                <div id="connection-status" class="status-indicator hidden">
                    <span class="status-dot"></span>
                    <span class="status-text">Disconnected</span>
                </div>

                <!-- Active Transfer Area -->
                <section id="transfer-panel" class="hidden">
                    <div class="drop-zone" id="drop-zone">
                        <p>Drop files to seed</p>
                        <input type="file" id="file-input" multiple hidden>
                    </div>
                    <button id="share-file-btn" class="btn primary-btn share-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            style="margin-right: 8px;">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                            <polyline points="17 8 12 3 7 8" />
                            <line x1="12" y1="3" x2="12" y2="15" />
                        </svg>
                        Share File
                    </button>
                    <div class="active-transfers">
                        <span class="label">Sending / Receiving</span>
                        <div id="transfers-list" class="transfers-list"></div>
                    </div>
                </section>
            </section>

            <!-- Received Files Panel (to the right of identity) -->
            <section id="received-panel" class="panel secondary-panel hidden">
                <div class="received-files">
                    <span class="label">Received Pollen</span>
                    <div id="received-list" class="transfers-list"></div>
                </div>
            </section>

            <!-- Dandelion Stage -->
            <section id="dandelion-container" class="dandelion-stage">
                <div class="dandelion" id="dandelion">
                    <!-- Head generated by JS -->
                </div>
            </section>
        </main>

        <!-- Camera Modal -->
        <div id="camera-modal" class="modal hidden">
            <div class="modal-content">
                <div id="qr-reader"></div> <!-- Container for scanner -->
                <video id="qr-video" style="display:none"></video> <!-- Fallback/hidden -->
                <button id="close-camera-btn" class="btn">Close</button>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>

</html>